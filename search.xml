<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>openstack常用命令整理</title>
    <url>/2023/05/24/openstack/</url>
    <content><![CDATA[<h2 id="配额-「quota」"><a href="#配额-「quota」" class="headerlink" title="配额 「quota」"></a>配额 「quota」</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openstack quota set --ram 1024 --instances 5 --cores 3 &#123;项目名&#125;     # 项目限制配额</span><br></pre></td></tr></table></figure>

<h2 id="虚拟机-「server」"><a href="#虚拟机-「server」" class="headerlink" title="虚拟机 「server」"></a>虚拟机 「server」</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openstack console url show &#123;虚拟机名字&#125;</span><br><span class="line">openstack server delete &#123;虚拟机名字&#125;</span><br><span class="line">openstack server force-delete &#123;虚拟机名字&#125;       # 强制删除虚机</span><br><span class="line">openstack server list / show  </span><br><span class="line">openstack server resize      # 调整云主机大小</span><br><span class="line">openstack server event list --long &#123;虚拟机 id&#125;    # 查询云主机的事件</span><br></pre></td></tr></table></figure>

<h2 id="搁置-「shelve」"><a href="#搁置-「shelve」" class="headerlink" title="搁置 「shelve」"></a>搁置 「shelve」</h2><p>对于一些长时间不使用的虚拟机，即使处于关机状态，仍然会占用着集群资源<br>如果需要释放这些资源,则使用shelve来操作,该操作会将server实例作为image保存到glance中,然后在宿主机中删除该server实例</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openstack server shelve &#123;虚机id&#125;  # 机器开启搁置状态 （搁置状态：--status SHELVED_OFFLOADED ）</span><br><span class="line">openstack server unshelve     # 取消搁置的机器</span><br></pre></td></tr></table></figure>

<h2 id="镜像-「image」"><a href="#镜像-「image」" class="headerlink" title="镜像 「image」"></a>镜像 「image」</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">共享私有镜像给其他项目</span><br><span class="line"></span><br><span class="line">openstack image set --shared &#123;镜像id&#125;    # 镜像设置为共享</span><br><span class="line">openstack image add project  &#123;镜像id&#125;  &#123;目标项目id&#125; </span><br><span class="line">openstack role add --user &#123;&#125;  project_member --project  &#123;目标项目id&#125; </span><br><span class="line"></span><br><span class="line">export OS_PROJECT_NAME=&#123;目标项目名&#125;       # 切换项目</span><br><span class="line">openstack image set --accept &#123;目标镜像id&#125; </span><br><span class="line">export OS_PROJECT_NAME=&#123;&#125;</span><br><span class="line">openstack role remove --user &#123;&#125; project_member --project &#123;目标项目id&#125;</span><br><span class="line"></span><br><span class="line">openstack image member list &#123;目标镜像id&#125;     # 验证是否共享成功</span><br><span class="line"></span><br><span class="line">openstack image set  # 更新镜像</span><br></pre></td></tr></table></figure>



<h2 id="网络-「network」"><a href="#网络-「network」" class="headerlink" title="网络 「network」"></a>网络 「network」</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openstack floating ip list </span><br><span class="line"></span><br><span class="line">云主机添加无IP的网卡</span><br><span class="line">openstack network list --project &#123;项目名&#125;    # 查看项目下网络</span><br><span class="line"></span><br><span class="line">openstack port create  --network  &#123;网络id/name&#125;   &#123;端口名&#125;     在不指定IP地址的情况下创建一个端口</span><br><span class="line"></span><br><span class="line">创建指定IP地址的端口</span><br><span class="line">openstack port create --network net1 --fixed-ip subnet=subnet1,ip-address=192.0.2.40 &#123;端口名&#125;  </span><br><span class="line"></span><br><span class="line">openstack port list </span><br><span class="line">nova interface-attach --port-id  &#123;port id&#125;   &#123;server id&#125;   </span><br></pre></td></tr></table></figure>



<h2 id="支付者-「assignment」"><a href="#支付者-「assignment」" class="headerlink" title="支付者 「assignment」"></a>支付者 「assignment」</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openstack role assignment list  --project  &#123;项目名&#125;  --name  # 查看用户的支付者</span><br></pre></td></tr></table></figure>



<h2 id="卷-「volume」"><a href="#卷-「volume」" class="headerlink" title="卷  「volume」"></a>卷  「volume」</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openstack volume type list   # 查看卷类型</span><br><span class="line">openstack volume set --state &#123;&#125;     # 改变云硬盘状态  </span><br><span class="line">openstack volume backup list   # 查看云硬盘备份</span><br><span class="line">openstack volume snapshot list --all --volume &#123; id/name &#125;</span><br><span class="line"></span><br><span class="line">nova  volume-detach  &#123;云主机ID&#125; &#123;volume id&#125;     # 分离卷</span><br></pre></td></tr></table></figure>

<p>Volume 除了可以用作 instance 的数据盘，也可以作为启动盘（Bootable Volume）创建Volume时，选择Volume Source为image，创建后可以看到该volume是Bootable的，后可根据需求创建可启动volume</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openstack volume create --image $IMAGE_ID --size $SIZE --type $TYPE --bootable $NAME</span><br></pre></td></tr></table></figure>



<h2 id="迁移-「migrate」"><a href="#迁移-「migrate」" class="headerlink" title="迁移  「migrate」"></a>迁移  「migrate」</h2><p>迁移的云主机若内存等资源使用率过高会导致热迁移实例写入内存页面的速度可能比复制它们的速度快<br>从而虚拟机产生了内存脏数据,无法完成迁移超时,虚拟机状态error</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nova live-migration-force-complete 实例ID 迁移ID        # 强制迁移</span><br><span class="line">nova server-migration-list 实例ID                  # 获取迁移的任务ID</span><br><span class="line">nova live-migration-abort 实例ID 迁移ID                 # 取消迁移</span><br></pre></td></tr></table></figure>



<h2 id="负载均衡-「loadbalancer」"><a href="#负载均衡-「loadbalancer」" class="headerlink" title="负载均衡  「loadbalancer」"></a>负载均衡  「loadbalancer」</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openstack loadbalancer list</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>openstack</category>
      </categories>
  </entry>
</search>
